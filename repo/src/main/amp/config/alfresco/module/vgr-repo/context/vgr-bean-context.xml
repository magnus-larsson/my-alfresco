<?xml version='1.0' encoding='UTF-8'?>

<beans xmlns="http://www.springframework.org/schema/beans" xmlns:http="http://cxf.apache.org/transports/http/configuration" xmlns:sec="http://cxf.apache.org/configuration/security" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:p="http://www.springframework.org/schema/p"
  xmlns:context="http://www.springframework.org/schema/context"
  xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
                           http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd
                           http://cxf.apache.org/configuration/security http://cxf.apache.org/schemas/configuration/security.xsd
                           http://cxf.apache.org/transports/http/configuration http://cxf.apache.org/schemas/configuration/http-conf.xsd">

  <!-- activate the load time weaver for weaving aspects into classes and also accessing private methods -->
  <context:load-time-weaver aspectj-weaving="on" />

  <!-- This is a helper bean for getting hold of the current application context and making it available with a static method -->
  <bean id="vgr.applicationContextHolder" class="se.vgregion.alfresco.repo.utils.ApplicationContextHolder" />

  <bean id="vgr.abstractConstraint" class="se.vgregion.alfresco.repo.constraints.AbstractConstraintBean" abstract="true" p:nodeService-ref="NodeService" />

  <bean id="vgr.storageService" class="se.vgregion.alfresco.repo.storage.impl.StorageServiceImpl">
    <property name="nodeService" ref="NodeService" />
    <property name="fileFolderService" ref="FileFolderService" />
    <property name="permissionService" ref="PermissionService" />
    <property name="copyService" ref="CopyService" />
    <property name="serviceUtils" ref="vgr.serviceUtils" />
    <property name="behaviourFilter" ref="policyBehaviourFilter" />
    <property name="contentService" ref="ContentService" />
    <property name="searchService" ref="SearchService" />
    <property name="dictionaryService" ref="DictionaryService" />
    <property name="retryingTransactionHelper" ref="retryingTransactionHelper" />
    <property name="actionService" ref="ActionService" />
    <property name="ownableService" ref="OwnableService" />
    <property name="renditionService" ref="RenditionService" />
    <property name="personService" ref="PersonService" />
    <property name="namespaceService" ref="NamespaceService" />
    <property name="repository" ref="repositoryHelper" />
    <property name="pdfaPilotEnabled" value="${pdfapilot.enabled}" />
    <property name="publishingService" ref="vgr.publishingService" />
    <property name="lockService" ref="LockService" />
  </bean>

  <bean id="vgr.kivWsClient" class="se.vgregion.alfresco.repo.kivclient.KivWsClient">
    <constructor-arg name="username" value="${kiv.username}" />
    <constructor-arg name="password" value="${kiv.password}" />
    <property name="endpointUri" value="${kiv.address}" />
  </bean>

  <bean id="vgr.storageScript" parent="baseJavaScriptExtension" class="se.vgregion.alfresco.repo.scripts.ScriptStorageService">
    <property name="storageService" ref="vgr.storageService" />
    <property name="extensionName" value="storage" />
  </bean>

  <!-- Controller for the web script Clear Cache -->
  <bean id="webscript.clearcache.clearcache.get" class="se.vgregion.alfresco.repo.scripts.ClearCache" parent="webscript" />

  <!-- Controller for the web script Published -->
  <bean id="webscript.feed.document.published.get" class="se.vgregion.alfresco.repo.scripts.Published" parent="webscript">
    <property name="pushAtomFeedUtil" ref="vgr.pushAtomFeedUtil" />
    <property name="publishingService" ref="vgr.publishingService" />
  </bean>

  <!-- Controller for the web script Published -->
  <bean id="webscript.probe.probe.get" class="org.redpill.alfresco.clusterprobe.repo.ProbeScript" parent="webscript.org.redpill.alfresco.clusterprobe.probe.get" />

  <!-- Need to override the "registerContentWithVersionService" to replace the version label calculation done for cm:content alternatively create a new bean for all custom content types. -->

  <bean id="registerContentWithVersionService" class="org.alfresco.repo.version.VersionServiceVersionLabelRegistrationBean" init-method="register" depends-on="vgr.dictionaryBootstrap">
    <property name="versionService">
      <ref bean="versionService" />
    </property>
    <property name="namespacePrefixResolver">
      <ref bean="namespaceService" />
    </property>
    <property name="typeQName">
      <value>vgr:document</value>
    </property>
    <property name="policy">
      <ref bean="vgr.configurableSerialVersionLabelPolicy" />
    </property>
  </bean>

  <!-- **** -->
  <!-- I18N -->
  <!-- ***** -->

  <bean id="vgr.resourceBundles" class="org.alfresco.i18n.ResourceBundleBootstrapComponent">
    <property name="resourceBundles">
      <list>
        <value>alfresco.module.vgr-repo.context.messages.vgr-patches</value>
        <value>alfresco.module.vgr-repo.context.messages.vgr-mail</value>
        <value>alfresco.module.vgr-repo.context.messages.vgr-data-list-model</value>
      </list>
    </property>
  </bean>

  <!-- *********************************** -->
  <!-- LDAP search in the Portal Directory -->
  <!-- *********************************** -->

  <bean id="vgr.contextSource" class="org.springframework.ldap.pool.factory.PoolingContextSource">
    <property name="contextSource" ref="vgr.contextSourceTarget" />
    <property name="dirContextValidator" ref="vgr.dirContextValidator" />
    <property name="testOnBorrow" value="true" />
    <property name="testWhileIdle" value="true" />
  </bean>

  <bean id="vgr.dirContextValidator" class="org.springframework.ldap.pool.validation.DefaultDirContextValidator" />

  <bean id="vgr.contextSourceTarget" class="org.springframework.ldap.core.support.LdapContextSource">
    <property name="url" value="${ldap.authentication.java.naming.provider.url}" />
    <property name="userDn" value="${ldap.synchronization.java.naming.security.principal}" />
    <property name="password" value="${ldap.synchronization.java.naming.security.credentials}" />
    <property name="base" value="${ldap.synchronization.userSearchBase}" />
    <property name="pooled" value="false" />
  </bean>

  <bean id="vgr.ldapTemplate" class="org.springframework.ldap.core.LdapTemplate">
    <property name="contextSource" ref="vgr.contextSource" />
  </bean>

  <bean id="vgr.portalLdapService" class="se.vgregion.alfresco.repo.ldap.impl.PortalLdapServiceImpl">
    <property name="ldapTemplate" ref="vgr.ldapTemplate" />
    <property name="usernameAttribute" value="${ldap.synchronization.userIdAttributeName}" />
    <property name="firstnameAttribute" value="${ldap.synchronization.userFirstNameAttributeName}" />
    <property name="lastnameAttribute" value="${ldap.synchronization.userLastNameAttributeName}" />
    <property name="organisationAttribute" value="${ldap.synchronization.userOrganizationalIdAttributeName}" />
    <property name="emailAttribute" value="${ldap.synchronization.userEmailAttributeName}" />
  </bean>

  <bean id="vgr.portalLdapScript" parent="baseJavaScriptExtension" class="se.vgregion.alfresco.repo.scripts.ScriptPortalLdapService">
    <property name="portalLdapService" ref="vgr.portalLdapService" />
    <property name="userRegistrySynchronizer" ref="userRegistrySynchronizer" />
    <property name="extensionName" value="portalLdap" />
    <property name="personService" ref="personService" />
    <property name="nodeService" ref="NodeService" />
  </bean>

  <!-- ****************************** -->
  <!-- Bean for publish files to feed -->
  <!-- ****************************** -->

  <bean id="vgr.pushService" class="se.vgregion.alfresco.repo.push.impl.PushServiceImpl">
    <property name="feedUrl" value="${vgr.feed.url}" />
    <property name="pushServerUrl" value="${vgr.pushserver.url}" />
    <property name="dumpFeed" value="false" />
    <property name="serviceUtils" ref="vgr.serviceUtils" />
    <property name="searchService" ref="SearchService" />
  </bean>

  <bean id="vgr.pushServiceScript" parent="baseJavaScriptExtension" class="se.vgregion.alfresco.repo.scripts.ScriptPushService">
    <property name="extensionName" value="pushService" />
    <property name="nodeService" ref="NodeService" />
    <property name="behaviourFilter" ref="policyBehaviourFilter" />
  </bean>

  <bean id="vgr.pushAtomFeedUtil" class="se.vgregion.alfresco.repo.push.impl.PuSHAtomFeedUtilImpl">
    <property name="descriptorService" ref="DescriptorService" />
    <property name="nodeService" ref="NodeService" />
    <property name="serviceUtils" ref="vgr.serviceUtils" />
    <property name="downloadUrl" value="${vgr.push.downloadUrl}" />
    <property name="publishingService" ref="vgr.publishingService" />
  </bean>

  <bean id="vgr.pushJmsService" class="se.vgregion.alfresco.repo.push.impl.PushJmsServiceImpl">
    <property name="nodeService" ref="NodeService" />
    <property name="queueName" value="${vgr.pushJms.queueName}" />
    <property name="consumerRemoteUrl" value="${vgr.pushJms.consumerRemoteUrl}" />
    <property name="producerLocalUrl" value="${vgr.pushJms.producerLocalUrl}" />
    <property name="vgrHdrSenderId" value="${vgr.pushJms.vgrHdrSenderId}" />
    <property name="vgrHdrReceiverId" value="${vgr.pushJms.vgrHdrReceiverId}" />
    <property name="vgrHdrMessageTypeVersion" value="${vgr.pushJms.VgrHdrMessageTypeVersion}" />
    <property name="pushAtomFeedUtil" ref="vgr.pushAtomFeedUtil" />
    <property name="testMode" value="${vgr.pushserver.test}" />
  </bean>

  <bean id="vgr.publishingService" class="se.vgregion.alfresco.repo.publish.impl.PublishingServiceImpl">
    <property name="nodeService" ref="NodeService" />
    <property name="serviceUtils" ref="vgr.serviceUtils" />
  </bean>

  <!-- *********************************** -->
  <!-- Service bean for all things related -->
  <!-- *********************************** -->

  <bean id="vgr.serviceUtils" class="se.vgregion.alfresco.repo.utils.impl.ServiceUtilsImpl">
    <property name="transactionService" ref="TransactionService" />
    <property name="nodeService" ref="NodeService" />
    <property name="authenticationService" ref="AuthenticationService" />
    <property name="personService" ref="PersonService" />
    <property name="lockService" ref="LockService" />
    <property name="dictionaryService" ref="DictionaryService" />
    <property name="searchService" ref="SearchService" />
    <property name="siteService" ref="siteService" />
    <property name="mimetypeService" ref="MimetypeService" />
    <property name="contentService" ref="ContentService" />
    <property name="fileFolderService" ref="FileFolderService" />
    <property name="globalProperties" ref="global-properties" />
    <property name="permissionService" ref="PermissionService" />
    <property name="authorityService" ref="AuthorityService" />
    <property name="behaviourFilter" ref="policyBehaviourFilter" />
  </bean>

  <bean id="vgr.serviceUtilsScript" parent="baseJavaScriptExtension" class="se.vgregion.alfresco.repo.scripts.ScriptServiceUtils">
    <property name="extensionName" value="serviceUtils" />
    <property name="serviceRegistry" ref="ServiceRegistry" />
    <property name="serviceUtils" ref="vgr.serviceUtils" />
    <property name="siteService" ref="SiteService" />
  </bean>

  <!-- **************************** -->
  <!-- Bean for VGR dok and WEB dok -->
  <!-- **************************** -->

  <bean id="webscript.webdok.webdok.get" class="se.vgregion.alfresco.repo.scripts.WebDok" parent="webscript.org.alfresco.cmis.content.get">
    <property name="searchService" ref="SearchService" />
    <property name="serviceUtils" ref="vgr.serviceUtils" />
    <property name="storageService" ref="vgr.storageService" />
  </bean>

  <bean id="webscript.vgrdok.migrate.get" class="se.vgregion.alfresco.repo.scripts.Migrate" parent="webscript">
    <property name="baseFolder" value="${vgr.vgrdok.import.path}" />
    <property name="fileFolderService" ref="FileFolderService" />
    <property name="siteService" ref="SiteService" />
    <property name="nodeService" ref="NodeService" />
    <property name="checkOutCheckInService" ref="CheckoutCheckinService" />
    <property name="versionService" ref="VersionService" />
    <property name="serviceUtils" ref="vgr.serviceUtils" />
    <property name="contentService" ref="ContentService" />
    <property name="searchService" ref="SearchService" />
    <property name="storageService" ref="vgr.storageService" />
    <property name="onlyMetadata" value="false" />
  </bean>

  <bean id="vgr.vgrDokScript" parent="baseJavaScriptExtension" class="se.vgregion.alfresco.repo.scripts.ScriptVgrDok">
    <property name="extensionName" value="vgrDok" />
    <property name="serviceUtils" ref="vgr.serviceUtils" />
    <property name="searchService" ref="SearchService" />
    <property name="storageService" ref="vgr.storageService" />
    <property name="nodeService" ref="NodeService" />
  </bean>

  <!-- ************************************************ -->
  <!-- Overridden beans for supporting , in multivalues -->
  <!-- ************************************************ -->

  <bean id="nodeFormProcessor" class="se.vgregion.alfresco.repo.forms.processor.node.VgrNodeFormProcessor" parent="baseFormProcessor">
    <property name="filterRegistry" ref="nodeFilterRegistry" />
    <property name="matchPattern" value="node" />
  </bean>

  <bean id="vgrPropertyFieldProcessor" class="se.vgregion.alfresco.repo.forms.processor.node.VgrPropertyFieldProcessor" parent="qnameFieldProcessor" />

  <!-- *************************** -->
  <!-- KIV value specific services -->
  <!-- *************************** -->

  <bean id="vgr.kivService" class="se.vgregion.alfresco.repo.constraints.impl.KivServiceWSImpl">
    <property name="kivWsClient" ref="vgr.kivWsClient" />

  </bean>

  <bean id="vgr.kivUnitSearchThreadPoolExecutor" class="org.alfresco.util.ThreadPoolExecutorFactoryBean">
    <property name="poolName">
      <value>kivUnitSearchThreadPool</value>
    </property>
    <property name="corePoolSize">
      <value>2</value>
    </property>
    <property name="maximumPoolSize">
      <value>${vgr.kivUnitSearchMaxThreadPoolSize}</value>
    </property>
    <property name="threadPriority">
      <value>5</value>
    </property>
  </bean>

  <bean id="vgr.kivScript" parent="baseJavaScriptExtension" class="se.vgregion.alfresco.repo.scripts.ScriptKivService">
    <property name="kivService" ref="vgr.kivService" />
    <property name="kivUnitSynchronisation" ref="vgr.KivUnitSynchronisation" />
    <property name="extensionName" value="kiv" />
  </bean>

  <bean id="vgr.KivUnitSynchronisation" class="se.vgregion.alfresco.repo.constraints.sync.KivUnitSynchronisationImpl">
    <property name="kivService" ref="vgr.kivService" />
    <property name="searchService" ref="searchService" />
    <property name="nodeService" ref="nodeService" />
    <property name="fileFolderService" ref="FileFolderService" />
    <property name="jobLockService" ref="jobLockService" />
    <property name="transactionService" ref="TransactionService" />
    <property name="threadPoolExecutor" ref="vgr.kivUnitSearchThreadPoolExecutor" />
    <property name="repositoryHelper" ref="repositoryHelper" />
    <property name="namespaceService" ref="namespaceService" />
  </bean>

  <!-- ***************************** -->
  <!-- Bean for the metadata service -->
  <!-- ***************************** -->

  <bean id="vgr.metadata-writer.service" class="org.redpill.alfresco.module.metadatawriter.services.impl.MetadataServiceImpl" init-method="register" parent="metadata-writer.abstract.service">
    <property name="serviceName" value="vgr.metadata-writer.service" />
    <property name="converters">
      <list>
        <ref bean="vgr.metadata-writer.dateConverter" />
      </list>
    </property>
    <property name="mappings">
      <props>
        <prop key="Title">vgr:dc.title</prop>
        <prop key="nodeRef">sys:node-uuid</prop>
        <prop key="DC.title.alternative">vgr:dc.title.alternative</prop>
        <prop key="DC.title.filename">vgr:dc.title.filename</prop>
        <prop key="DC.title.filename.native">vgr:dc.title.filename.native</prop>
        <prop key="updated">cm:modified</prop>
        <prop key="dcterms.created">cm:created</prop>
        <prop key="DC.creator">vgr:dc.creator</prop>
        <prop key="DC.creator.id">vgr:dc.creator.id</prop>
        <prop key="summary">vgr:dc.description</prop>
        <prop key="DC.description">vgr:dc.description</prop>
        <prop key="DC.format.extent.mimetype">vgr:dc.format.extent.mimetype</prop>
        <prop key="DC.format.extent.mimetype.native">vgr:dc.format.extent.mimetype.native</prop>
        <prop key="DC.subject.authorkeywords">vgr:dc.subject.authorkeywords</prop>
        <prop key="DC.subject.keywords">vgr:dc.subject.keywords</prop>
        <prop key="DC.subject.keywords.id">vgr:dc.subject.keywords.id</prop>
        <prop key="DC.creator.freetext">vgr:dc.creator.freetext</prop>
        <prop key="DC.creator.document">vgr:dc.creator.document</prop>
        <prop key="DC.creator.document.id">vgr:dc.creator.document.id</prop>
        <prop key="DC.creator.function">vgr:dc.creator.function</prop>
        <prop key="DC.creator.forunit">vgr:dc.creator.forunit</prop>
        <prop key="DC.creator.forunit.id">vgr:dc.creator.forunit.id</prop>
        <prop key="DC.creator.recordscreator">vgr:dc.creator.recordscreator</prop>
        <prop key="DC.creator.recordscreator.id">vgr:dc.creator.recordscreator.id</prop>
        <prop key="DC.creator.project-assignment">vgr:dc.creator.project-assignment</prop>
        <prop key="DC.publisher">vgr:dc.publisher</prop>
        <prop key="DC.publisher.id">vgr:dc.publisher.id</prop>
        <prop key="DC.publisher.forunit">vgr:dc.publisher.forunit</prop>
        <prop key="DC.publisher.forunit.id">vgr:dc.publisher.forunit.id</prop>
        <prop key="DC.publisher.project-assignment">vgr:dc.publisher.project-assignment</prop>
        <prop key="DC.date.issued">vgr:dc.date.issued</prop>
        <prop key="DC.date.accepted">vgr:dc.date.accepted</prop>
        <prop key="DC.date.controlled">vgr:dc.date.controlled</prop>
        <prop key="DC.date.validfrom">vgr:dc.date.validfrom</prop>
        <prop key="DC.date.validto">vgr:dc.date.validto</prop>
        <prop key="DC.date.availablefrom">vgr:dc.date.availablefrom</prop>
        <prop key="DC.date.availableto">vgr:dc.date.availableto</prop>
        <prop key="DC.date.copyrighted">vgr:dc.date.copyrighted</prop>
        <prop key="DC.contributor.savedby">vgr:dc.contributor.savedby</prop>
        <prop key="DC.contributor.savedby.id">vgr:dc.contributor.savedby.id</prop>
        <prop key="DC.contributor.acceptedby">vgr:dc.contributor.acceptedby</prop>
        <prop key="DC.contributor.acceptedby.id">vgr:dc.contributor.acceptedby.id</prop>
        <prop key="DC.contributor.acceptedby.freetext">vgr:dc.contributor.acceptedby.freetext</prop>
        <prop key="DC.contributor.acceptedby.role">vgr:dc.contributor.acceptedby.role</prop>
        <prop key="DC.contributor.acceptedby.unit.freetext">vgr:dc.contributor.acceptedby.unit.freetext</prop>
        <prop key="DC.contributor.controlledby">vgr:dc.contributor.controlledby</prop>
        <prop key="DC.contributor.controlledby.id">vgr:dc.contributor.controlledby.id</prop>
        <prop key="DC.contributor.controlledby.freetext">vgr:dc.contributor.controlledby.freetext</prop>
        <prop key="DC.contributor.controlledby.role">vgr:dc.contributor.controlledby.role</prop>
        <prop key="DC.contributor.controlledby.unit.freetext">vgr:dc.contributor.controlledby.unit.freetext</prop>
        <prop key="DC.type.document">vgr:dc.type.document</prop>
        <prop key="DC.type.document.structure">vgr:dc.type.document.structure</prop>
        <prop key="DC.type.document.structure.id">vgr:dc.type.document.structure.id</prop>
        <prop key="DC.type.templatename">vgr:dc.type.templatename</prop>
        <prop key="DC.type.record">vgr:dc.type.record</prop>
        <prop key="DC.type.record.id">vgr:dc.type.record.id</prop>
        <prop key="DC.type.process.name">vgr:dc.type.process.name</prop>
        <prop key="DC.type.file.process">vgr:dc.type.file.process</prop>
        <prop key="DC.type.file">vgr:dc.type.file</prop>
        <prop key="DC.type.document.serie">vgr:dc.type.document.serie</prop>
        <prop key="DC.type.document.id">vgr:dc.type.document.id</prop>
        <prop key="DC.format.extent">vgr:dc.format.extent</prop>
        <prop key="DC.format.extension">vgr:dc.format.extension</prop>
        <prop key="DC.format.extension.native">vgr:dc.format.extension.native</prop>
        <prop key="DC.identifier">vgr:dc.identifier</prop>
        <prop key="DC.identifier.native">vgr:dc.identifier.native</prop>
        <prop key="DC.identifier.checksum">vgr:dc.identifier.native.checksum</prop>
        <prop key="DC.identifier.checksum.native">vgr:dc.identifier.native.checksum.native</prop>
        <prop key="DC.identifier.version">vgr:dc.identifier.version</prop>
        <prop key="DC.identifier.diarie.id">vgr:dc.identifier.diarie.id</prop>
        <prop key="DC.identifier.location">vgr:dc.identifier.location</prop>
        <prop key="DC.source">vgr:dc.source</prop>
        <prop key="DC.source.documentid">vgr:dc.source.documentid</prop>
        <prop key="DC.source.origin">vgr:dc.source.origin</prop>
        <prop key="DC.relation.isversionof">vgr:dc.relation.isversionof</prop>
        <prop key="DC.relation.replaces">vgr:dc.relation.replaces</prop>
        <prop key="DC.coverage.hsacode">vgr:dc.coverage.hsacode</prop>
        <prop key="DC.coverage.hsacode.id">vgr:dc.coverage.hsacode.id</prop>
        <prop key="dcterms.audience">vgr:dc.audience</prop>
        <prop key="dcterms.audience.id">vgr:dc.audience.id</prop>
        <prop key="VGR.status.document">vgr:vgr.status.document</prop>
        <prop key="VGR.status.document">vgr:vgr.status.document.id</prop>
        <prop key="DC.identifier.documentid">vgr:dc.identifier.documentid</prop>
        <prop key="DC.contributor.unit">vgr:dc.contributor.unit</prop>
        <prop key="DC.date.saved">vgr:dc.date.saved</prop>
        <prop key="DC.date.created">vgr:dc.date.created</prop>
        <prop key="DC.language">vgr:dc.language</prop>
        <prop key="DC.rights.accessrights">vgr:dc.rights.accessrights</prop>
        <prop key="hc.status.document">vgr:hc.status.document</prop>
        <prop key="DC.identifier.checksum.native">vgr:dc.identifier.checksum.native</prop>
        <prop key="DC.identifier.checksum">vgr:dc.identifier.checksum</prop>
      </props>
    </property>
  </bean>

  <bean id="vgr.metadata-writer.dateConverter" class="org.redpill.alfresco.module.metadatawriter.converters.impl.DateConverter">
    <constructor-arg type="java.lang.String" value="yyyy-MM-dd" />
  </bean>

  <!-- ********************************************* -->
  <!-- Bean for the VGR specific content.get service -->
  <!-- ********************************************* -->

  <bean id="webscript.se.vgregion.storage.content.get" class="se.vgregion.alfresco.repo.scripts.StorageContentGet" parent="webscript.org.alfresco.cmis.content.get">
    <property name="namespaceService" ref="NamespaceService" />
    <property name="serviceUtils" ref="vgr.serviceUtils" />
    <property name="storageService" ref="vgr.storageService" />
  </bean>

  <!-- ********************************************* -->
  <!-- Bean for the VGR specific content.get service -->
  <!-- ********************************************* -->

  <bean id="vgr.contentUrlScript" parent="baseJavaScriptExtension" class="se.vgregion.alfresco.repo.scripts.ContentUrlResolver">
    <property name="extensionName" value="contentUrlResolver" />
    <property name="fileFolderService" ref="FileFolderService" />
  </bean>

  <!-- ******************************************* -->
  <!-- Script bean to expose alfresco-global.properties to webscripts -->
  <!-- ******************************************* -->

  <bean id="vgr.global.properties" parent="baseJavaScriptExtension" class="se.vgregion.alfresco.repo.scripts.ScriptGlobalProperties">
    <property name="properties" ref="global-properties" />
    <property name="extensionName" value="properties" />
  </bean>

  <!-- Controller for the web script AcceptInvitation -->
  <bean id="webscript.invite.accept.get" class="se.vgregion.alfresco.repo.scripts.AcceptInvitation" parent="webscript">
    <property name="invitationService" ref="InvitationService" />
    <property name="authenticationService" ref="AuthenticationService" />
  </bean>

  <!-- Controller for the web script RejectInvitation -->
  <bean id="webscript.invite.reject.get" class="se.vgregion.alfresco.repo.scripts.RejectInvitation" parent="webscript">
    <property name="invitationService" ref="InvitationService" />
    <property name="authenticationService" ref="AuthenticationService" />
  </bean>

  <!-- Controller for the web script Invitations -->
  <bean id="webscript.invite.invitations.get" class="se.vgregion.alfresco.repo.scripts.Invitations" parent="webscript">
    <property name="invitationService" ref="InvitationService" />
    <property name="authenticationService" ref="AuthenticationService" />
    <property name="siteService" ref="siteService" />
  </bean>

  <!-- *************************************************** -->
  <!-- Rendering engine for rendering PDF/A compliant PDFs -->
  <!-- *************************************************** -->

  <bean id="pdfa" class="se.vgregion.alfresco.repo.rendition.executer.PdfaRenderingEngine" parent="baseRenderingAction" />

  <bean id="pdfapilot" class="se.vgregion.alfresco.repo.rendition.executer.PdfaPilotRenderingEngine" parent="baseRenderingAction">
    <property name="policyBehaviourFilter" ref="policyBehaviourFilter" />
  </bean>

  <!-- *************************************************** -->
  <!-- Rendering engine for rendering PDF/A compliant PDFs -->
  <!-- *************************************************** -->

  <bean id="metadataExtracterScript" class="se.vgregion.alfresco.repo.scripts.ScriptMetadataExtracter" parent="baseJavaScriptExtension">
    <property name="extensionName" value="metadataExtracter" />
    <property name="metadataExtracterRegistry" ref="metadataExtracterRegistry" />
    <property name="mimetypeService" ref="MimetypeService" />
  </bean>

  <!-- **************************************************************** -->
  <!-- Overridden bean for implementing external users specific for VGR -->
  <!-- **************************************************************** -->

  <bean id="vgr.externalUsersInvitationService" class="org.alfresco.repo.invitation.ExternalUsersInvitationServiceImpl" p:authenticationService-ref="AuthenticationService" p:externalUsersService-ref="vgr.externalUsers" p:namespaceService-ref="NamespaceService" p:invitationService-ref="invitationService"
    p:workflowService-ref="WorkflowService" p:personService-ref="PersonService" p:permissionService-ref="PermissionService" p:siteService-ref="SiteService" p:nodeService-ref="NodeService" p:userSynchronizer-ref="vgr.userSynchronizer" p:userRegistrySynchronizer-ref="userRegistrySynchronizer"
    p:serviceUtils-ref="vgr.serviceUtils" />

  <bean id="vgr.inviteNotificationHelper" class="se.vgregion.alfresco.repo.invitation.impl.InvitationNotificationHelperImpl">
    <property name="sysAdminParams" ref="sysAdminParams" />
    <property name="globalProperties" ref="global-properties" />
    <property name="personService" ref="PersonService" />
    <property name="actionService" ref="ActionService" />
    <property name="nodeService" ref="NodeService" />
    <property name="siteService" ref="SiteService" />
    <property name="repository" ref="repositoryHelper" />
    <property name="serviceRegistry" ref="ServiceRegistry" />
  </bean>

  <bean id="vgr.invitationServiceInterceptor" class="se.vgregion.alfresco.repo.invitation.InvitationServiceInterceptor">
    <property name="externalActivation" value="${vgr.external.activation}" />
    <property name="externalUsersInvitationService" ref="vgr.externalUsersInvitationService" />
    <property name="personService" ref="PersonService" />
    <property name="nodeService" ref="NodeService" />
    <property name="inviteNotificationHelper" ref="vgr.inviteNotificationHelper" />
  </bean>

  <bean id="InviteHelper" class="org.alfresco.repo.invitation.CustomInviteHelper">
    <property name="serviceRegistry" ref="ServiceRegistry" />
    <property name="repositoryHelper" ref="repositoryHelper" />
    <property name="messageService" ref="messageService" />
    <property name="invitationNotificationHelper" ref="vgr.inviteNotificationHelper" />
  </bean>

  <bean id="InvitationService" class="org.springframework.aop.framework.ProxyFactoryBean">
    <property name="proxyInterfaces">
      <list>
        <value>org.alfresco.service.cmr.invitation.InvitationService</value>
      </list>
    </property>
    <property name="targetName">
      <value>invitationService</value>
    </property>
    <property name="interceptorNames">
      <list>
        <idref bean="InvitationService_transaction" />
        <idref bean="AuditMethodInterceptor" />
        <idref bean="exceptionTranslator" />
        <idref bean="InvitationService_security" />
        <idref bean="vgr.invitationServiceInterceptor" />
      </list>
    </property>
  </bean>

  <bean id="vgr.userSynchronizer" class="se.vgregion.alfresco.repo.security.UserSynchronizer" p:applicationContextManager-ref="Authentication" p:authorityService-ref="authorityService" p:personService-ref="personService" p:ruleService-ref="ruleService" p:transactionService-ref="transactionService"
    p:zone="${vgr.external.users.zone}" />

  <!-- ****************************************************** -->
  <!-- Thumbnail definition that is actually a PDF preview :) -->
  <!-- ****************************************************** -->

  <bean name="pdfaPilot.pdfOptions" class="org.redpill.alfresco.repo.content.transform.PdfaPilotTransformationOptions">
    <property name="readLimitTimeMs" value="-1" />
    <property name="maxSourceSizeKBytes" value="-1" />
    <property name="readLimitKBytes" value="-1" />
    <property name="pageLimit" value="-1" />
    <property name="maxPages" value="-1" />
    <property name="includeEmbedded" value="true" />
    <property name="optimize" value="true" />
    <property name="level" value="" />
    <property name="timeoutMs" value="300000" />
    <property name="failSilently" value="false" />
  </bean>

  <bean id="thumbnail.register.pdf" class="org.alfresco.repo.thumbnail.ThumbnailDefinitionSpringRegisterer">
    <property name="thumbnailRegistry" ref="thumbnailRegistry" />
    <property name="thumbnailDefinition">
      <bean class="org.alfresco.repo.thumbnail.ThumbnailDefinition">
        <property name="name" value="pdf" />
        <property name="mimetype" value="application/pdf" />
        <property name="runAs" value="System" />
        <property name="failureHandlingOptions" ref="standardFailureOptions" />
        <property name="transformationOptions" ref="pdfaPilot.pdfOptions" />
      </bean>
    </property>
  </bean>

  <!-- ********************************************************** -->
  <!-- Thumbnail definition that is actually a PDF/A rendition :) -->
  <!-- ********************************************************** -->

  <bean name="pdfaPilot.pdfaOptions" class="org.redpill.alfresco.repo.content.transform.PdfaPilotTransformationOptions">
    <property name="readLimitTimeMs" value="-1" />
    <property name="maxSourceSizeKBytes" value="-1" />
    <property name="readLimitKBytes" value="-1" />
    <property name="pageLimit" value="-1" />
    <property name="maxPages" value="-1" />
    <property name="includeEmbedded" value="true" />
    <property name="optimize" value="false" />
    <property name="level" value="2b" />
    <property name="timeoutMs" value="300000" />
    <property name="failSilently" value="true" />
  </bean>

  <bean id="thumbnail.register.pdfa" class="org.alfresco.repo.thumbnail.ThumbnailDefinitionSpringRegisterer">
    <property name="thumbnailRegistry" ref="thumbnailRegistry" />
    <property name="thumbnailDefinition">
      <bean class="org.alfresco.repo.thumbnail.ThumbnailDefinition">
        <property name="name" value="pdfa" />
        <property name="mimetype" value="application/pdf" />
        <property name="runAs" value="System" />
        <property name="failureHandlingOptions" ref="standardFailureOptions" />
        <property name="transformationOptions" ref="pdfaPilot.pdfaOptions" />
      </bean>
    </property>
  </bean>

  <bean id="thumbnailRenditionConvertor" class="se.vgregion.alfresco.repo.thumbnail.CustomThumbnailRenditionConvertor">
    <property name="renditionService" ref="renditionService" />
  </bean>

  <!-- ***************************************************************************************************** -->
  <!-- Report site statistics web script and utility classes -->
  <!-- ***************************************************************************************************** -->

  <bean id="webscript.reports.sites.sites.get" class="se.vgregion.alfresco.repo.scripts.SitesReport" parent="webscript">
    <property name="siteService" ref="SiteService" />
  </bean>

  <bean id="vgr.siteReport" class="se.vgregion.alfresco.repo.scripts.ScriptSiteReport" parent="baseJavaScriptExtension">
    <property name="extensionName" value="siteReport" />
    <property name="siteService" ref="SiteService" />
    <property name="reportSiteUsage" ref="vgr.reportSiteUsage" />
  </bean>

  <bean id="vgr.reportSiteUsage" class="se.vgregion.alfresco.repo.report.ReportSiteUsage">
    <property name="activityService" ref="activityService" />
    <property name="fileFolderService" ref="FileFolderService" />
    <property name="nodeService" ref="NodeService" />
    <property name="siteService" ref="SiteService" />
  </bean>

  <!-- ***************************************************************************************************** -->
  <!-- Report active users statistics web script and utility classes -->
  <!-- ***************************************************************************************************** -->

  <bean id="webscript.reports.users.activeusers.get" class="se.vgregion.alfresco.repo.scripts.ActiveUsersReport" parent="webscript">
    <property name="activeUsers" ref="vgr.reportActiveUsers" />
  </bean>

  <bean id="vgr.reportActiveUsers" class="se.vgregion.alfresco.repo.report.ActiveUsers">
    <property name="nodeService" ref="NodeService" />
    <property name="personService" ref="PersonService" />
    <property name="auditService" ref="AuditService" />
  </bean>

  <!-- ***************************************************************************************************** -->
  <!-- Reset password service, webscript definitions and javascript proxy object -->
  <!-- ***************************************************************************************************** -->

  <bean id="vgr.resetPasswordService" class="se.vgregion.alfresco.repo.resetpassword.impl.ResetPasswordServiceImpl">
    <property name="siteService" ref="SiteService" />
    <property name="personService" ref="PersonService" />
    <property name="nodeService" ref="NodeService" />
    <property name="authorityService" ref="AuthorityService" />
    <property name="mutableAuthenticationService" ref="AuthenticationService" />
    <property name="sendMailService" ref="vgr.sendMailService" />
    <property name="globalProperties" ref="global-properties" />
  </bean>

  <bean id="webscript.resetpassword.resetpassword.put" class="se.vgregion.alfresco.repo.scripts.SiteAdminResetUserPassword" parent="webscript">
    <property name="resetPasswordService" ref="vgr.resetPasswordService" />
  </bean>

  <bean id="vgr.javascriptResetPasswordService" parent="baseJavaScriptExtension" class="se.vgregion.alfresco.repo.resetpassword.JavascriptCompatibleResetPasswordService">
    <property name="resetPasswordService" ref="vgr.resetPasswordService" />
    <property name="extensionName" value="resetPasswordService" />
  </bean>

  <!-- ***************************************************************************************************** -->
  <!-- Send mail service -->
  <!-- ***************************************************************************************************** -->

  <bean id="vgr.sendMailService" class="se.vgregion.alfresco.repo.mail.impl.SendMailServiceImpl">
    <property name="actionService" ref="ActionService" />
  </bean>

  <!-- ***************************************************************************************************** -->
  <!-- Publish status web scripts -->
  <!-- ***************************************************************************************************** -->

  <bean id="webscript.publishtostorage.publishstatus.post" class="se.vgregion.alfresco.repo.scripts.SetPublishStatus" parent="webscript">
    <property name="globalProperties" ref="global-properties" />
    <property name="nodeService" ref="NodeService" />
    <property name="behaviourFilter" ref="policyBehaviourFilter" />
  </bean>

  <bean id="webscript.publishtostorage.publishstatus.get" class="se.vgregion.alfresco.repo.scripts.GetPublishStatus" parent="webscript">
    <property name="storageService" ref="vgr.storageService" />
    <property name="nodeService" ref="NodeService" />
    <property name="serviceUtils" ref="vgr.serviceUtils" />
  </bean>

  <bean id="webscript.publishtostorage.publishreport.get" class="se.vgregion.alfresco.repo.scripts.ScriptGetDocumentsPublishReport" parent="webscript">
    <property name="pushService" ref="vgr.pushService" />
    <property name="nodeService" ref="NodeService" />
  </bean>

  <bean id="webscript.publishtostorage.repush.post" class="se.vgregion.alfresco.repo.scripts.Repush" parent="webscript">
    <property name="storageService" ref="vgr.storageService" />
    <property name="pushService" ref="vgr.pushService" />
    <property name="nodeService" ref="NodeService" />
    <property name="behaviourFilter" ref="policyBehaviourFilter" />
  </bean>

  <!-- ***************************************************************************************************** -->
  <!-- Trigger User Update web scripts -->
  <!-- ***************************************************************************************************** -->

  <bean id="webscript.se.vgregion.admin.trigger-user-update.get" class="se.vgregion.alfresco.repo.scripts.TriggerUserUpdate" parent="webscript">
    <property name="nodeService" ref="NodeService" />
    <property name="searchService" ref="SearchService" />
    <property name="behaviourFilter" ref="policyBehaviourFilter" />
    <property name="transactionService" ref="TransactionService" />
  </bean>

  <!-- ***************************************************** -->
  <!-- Script for getting nodes with missing PDF/A rendition -->
  <!-- ***************************************************** -->

  <bean id="webscript.se.vgregion.alfresco.console.pdfa.missing.get" class="se.vgregion.alfresco.repo.scripts.MissingGet" parent="webscript">
    <property name="nodeService" ref="NodeService" />
    <property name="permissionService" ref="PermissionService" />
    <property name="renditionService" ref="RenditionService" />
    <property name="searchService" ref="SearchService" />
    <property name="storageService" ref="vgr.storageService" />
  </bean>

  <bean id="add-failed-rendition" class="se.vgregion.alfresco.repo.rendition.executer.AddFailedRenditionActionExecuter" parent="action-executer">
    <property name="publicAction" value="false" />
    <property name="nodeService" ref="NodeService" />
    <property name="behaviourFilter" ref="policyBehaviourFilter" />
    <property name="renditionService" ref="RenditionService" />
  </bean>

  <bean id="node-eligible-for-rerendering-evaluator" class="se.vgregion.alfresco.repo.rendition.executer.NodeEligibleForRerenderingEvaluator" parent="action-condition-evaluator">
    <property name="publicCondition" value="false" />
    <property name="nodeService" ref="nodeService" />
    <property name="renditionService" ref="RenditionService" />
    <property name="storageService" ref="vgr.storageService" />
  </bean>

  <bean id="vgr.failedPdfaRenditionEmailTemplateLocation" class="org.alfresco.repo.dictionary.RepositoryLocation">
    <property name="path">
      <value>/app:company_home/app:dictionary/app:email_templates/cm:failedPdfaRenditionEmailTemplate/cm:failed-pdfa-rendition-email.ftl</value>
    </property>
  </bean>

  <!-- *************************************************************** -->
  <!-- Override of version service to allow for initial minor versions -->
  <!-- *************************************************************** -->

  <bean id="versionService" class="org.alfresco.repo.version.CustomVersion2ServiceImpl" init-method="initialise">
    <property name="nodeService">
      <ref bean="NodeService" />
    </property>
    <property name="dbNodeService">
      <ref bean="mtAwareNodeService" />
    </property>
    <property name="searcher">
      <ref bean="versionSearchService" />
    </property>
    <property name="dictionaryService">
      <ref bean="dictionaryService" />
    </property>
    <property name="policyComponent">
      <ref bean="policyComponent" />
    </property>
    <property name="policyBehaviourFilter">
      <ref bean="policyBehaviourFilter" />
    </property>
    <property name="permissionService">
      <ref bean="permissionService" />
    </property>
    <property name="onlyUseDeprecatedV1">
      <value>${version.store.onlyUseDeprecatedV1}</value>
    </property>
    <property name="versionMigrator">
      <ref bean="versionMigrator" />
    </property>
    <property name="versionComparatorClass">
      <value>${version.store.versionComparatorClass}</value>
    </property>
    <property name="defaultVersionIsMajorVersion">
      <value>${version.defaultVersionIsMajorVersion}</value>
    </property>
  </bean>

</beans>
