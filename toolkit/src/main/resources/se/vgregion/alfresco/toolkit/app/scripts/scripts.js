"use strict";function Splash(a,b){this.open=function(c,d){var e=b.$new();return angular.extend(e,c),d=angular.extend(d||{},{backdrop:!1,scope:e,templateUrl:"splash/content.html",windowTemplateUrl:"splash/index.html"}),a.open(d)}}angular.module("toolkitApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","restangular","ngTable","toaster","angularSpinner","ui.ladda","ui.bootstrap","ui.router"]).run(["$rootScope","$state","$stateParams",function(a,b,c){a.$state=b,a.$stateParams=c}]).config(["RestangularProvider",function(a){a.addResponseInterceptor(function(a,b){var c;return"getList"===b?(c=a.data,c.total=a.total):c=a,c}),a.setBaseUrl("/alfresco/service/vgr/toolkit")}]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/")}]);var MainController=["$scope","Restangular","ngTableParams","toaster","$timeout","usSpinnerService","splash","$q","$sce",function(a,b,c,d,e,f,g,h,i){function j(a,b,c){var d=0,e=!1,f=!1,g={next:function(){return e?void(f&&c&&c()):void(a>d?(d++,b(g)):(e=!0,c&&c()))},iteration:function(){return d-1},"break":function(a){e=!0,f=a}};return g.next(),g}function k(a){var b;switch(a){case 100:b="Not serialized (no valid serialization found or keycode expired)";break;case 101:b="Command line parameter error";break;case 102:b="Command line syntax error (illegal command)";break;case 103:b="Unknown error (internal error)";break;case 104:b="A file could not be opened";break;case 105:b="An encrypted PDF file could not be opened for writing";break;case 106:b="A file could not be saved";break;case 110:b="Action is not distributable";break;case 111:b="No Dispatcher was found";break;case 112:b="No Satellite was found or is ready for execution";break;case 130:b="Execution is cancelled after timeout";break;default:b='Unknown exit code "'+a+'"'}return b}function l(a){var b;switch(a){case 1e3:b="Unknown reason";break;case 1001:b="A parameter is wrong";break;case 1002:b="A requested file could not be found";break;case 1003:b="A requested folder could not be found";break;case 1004:b="A requested folder is a file";break;case 1005:b="A requested file is a folder";break;case 1006:b="30 days trial period expired";break;case 1007:b="Time limited keycode expired";break;case 1008:b="Invalid activation";break;case 1009:b="PDF does not contain ICC profiles";break;case 1010:b="A file could not be opened";break;case 1011:b="An encrypted PDF file could not be opened for writing";break;case 1012:b="A file could not be saved";break;default:b='Unknown error code "'+a+'"'}return b}a.timeout||(a.timeout=300),a.tableParams=new c({page:1,count:5,sorting:{last:"asc"}},{counts:[],total:1,getData:function(a,c){b.all("failed").getList({sort:c.sorting().last}).then(function(b){c.total(b.total),a.resolve(b)},function(b){a.reject(b)})}}),a.rerender=function(b){var c=h.defer();a.error=null,b.stacktrace=null,a.working=!0,b.working=!0;var e=(new Date).getTime();return f.spin("spinner-1"),b.put({timeout:a.timeout?1e3*a.timeout:3e5}).then(function(g){f.stop("spinner-1");var h=(new Date).getTime(),i=(h-e)/1e3;a.working=!1,b.working=!1,g.success?(d.pop("success","PDF/A render","PDF/A rendering successfull ("+i+" seconds)"),b.success=!0):d.pop("error","PDF/A render","PDF/A rendering failed ("+i+" seconds)"),c.resolve()},function(g){f.stop("spinner-1");var h=(new Date).getTime();a.working=!1,b.working=!1,a.time=(h-e)/1e3,a.error=g.data,b.stacktrace=g.data;var j=g.data.match(/(exit\scode:\s+)(\d+)/),m=g.data.match(/(Error\s+)(\d+)/);j&&j.length>=2&&(b.error=k(parseInt(j[2]))+" (exit code: "+j[2]+")"),m&&m.length>=2&&(b.error&&(b.error+="<br/>"),b.error+=l(parseInt(m[2]))+" (error code: "+m[2]+")"),b.error=i.trustAsHtml(b.error),d.pop("error","PDF/A render","PDF/A rendering failed ("+a.time+" seconds)"),c.reject()}),c.promise},a.rerenderAll=function(){var b=a.tableParams.data.length;j(b,function(b){var c=a.tableParams.data[b.iteration()],d=a.rerender(c);d.then(function(){b.next()},function(){b.next()})},function(){d.pop("success","PDF/A render","Rerender all finished")})},a.showError=function(a){g.open({title:"Error",message:a})}}];MainController.$inject=["$scope","Restangular","ngTableParams","toaster","$timeout","usSpinnerService","splash","$q","$sce"],angular.module("toolkitApp").config(["$stateProvider",function(a){a.state("main",{url:"/",templateUrl:"views/main.html",controller:"MainController"})}]).controller("MainController",MainController);var CheckSolrIndexController=["$scope","Restangular","ngTableParams","$http","$q","splash","toaster",function(a,b,c,d,e,f,g){a.refresh=function(){d.get("/alfresco/service/vgr/toolkit/cache/refresh",{}).success(function(){g.pop("success","Refresh Success","Refresh cache job is started, it will take some time to finish."),node.repushed=!0}).error(function(a){g.pop("error","Refresh Failure",'Refresh if cache failed, message "'+a+'"')})},b.one("cache","alfresco_orphans").get().then(function(b){a.alfrescoOrphans=[];for(var c=0;c<b.orphans.length;c++)d.get("/alfresco/service/vgr/toolkit/cache/check",{params:{nodeRef:b.orphans[c]}}).success(function(b){b.result===!1&&(a.alfrescoOrphans.push({nodeRef:b.nodeRef}),a.alfrescoOrphansTableParameters.reload())}).error(function(a,b){g.pop("error","Check Failure",'Check of cached node failed, message "'+b+'"')});a.alfrescoOrphansModified=b.cacheDate}).then(function(){a.alfrescoOrphansTableParameters.reload()}),b.one("cache","solr_orphans").get().then(function(b){a.solrOrphans=[];for(var c=0;c<b.orphans.length;c++){var e={nodeRef:b.orphans[c]};d.get("/alfresco/service/api/metadata?nodeRef="+e.nodeRef).success(function(a){e.exists=0!==Object.keys(a).length}),a.solrOrphans.push(e)}a.solrOrphansModified=b.cacheDate}).then(function(){a.solrOrphansTableParameters.reload()}),a.alfrescoOrphansTableParameters=new c({page:1,count:5},{counts:[],total:1,getData:function(b){a.alfrescoOrphans&&b.resolve(a.alfrescoOrphans)}}),a.solrOrphansTableParameters=new c({page:1,count:5},{counts:[],total:1,getData:function(b){a.solrOrphans&&b.resolve(a.solrOrphans)}}),a.getMetadata=function(a){d.get("/alfresco/service/api/metadata?nodeRef="+a.nodeRef).success(function(a){f.open({title:"Metadata",message:angular.toJson(a,3)})})},a.repush=function(a){d.put("/alfresco/service/vgr/toolkit/repush",{nodeRef:a.nodeRef}).success(function(b,c){var c=b.success;c="REPUSHED_FOR_PUBLISHED"===c?"published":"unpublished",g.pop("success","Repush Success",'Repush of "'+a.nodeRef+'" as "'+c+'" successfull.'),a.repushed=!0}).error(function(b,c){var d='Repush of "'+a.nodeRef+'" failed.';404===c&&(d=b),g.pop("error","Repush Failure",d)})}}];CheckSolrIndexController.$inject=["$scope","Restangular","ngTableParams","$http","$q","splash","toaster"],angular.module("toolkitApp").config(["$stateProvider",function(a){a.state("checkSolrIndex",{url:"/checksolrindex",templateUrl:"views/checkSolrIndex.html",controller:"CheckSolrIndexController"})}]).controller("CheckSolrIndexController",CheckSolrIndexController),Splash.$inject=["$modal","$rootScope"],angular.module("toolkitApp").service("splash",Splash),angular.module("toolkitApp").run(["$templateCache",function(a){a.put("splash/index.html",'<section class="splash" ng-class="{\'splash-open\': animate}" ng-style="{\'z-index\': 1000, display: \'block\'}" ng-click="close($event)"> <div class="splash-inner" ng-transclude></div></section>'),a.put("splash/content.html",'<div class="splash-content"> <h1 ng-bind="title"></h1> <pre ng-bind="message"></pre> <button class="btn btn-lg btn-outline" ng-click="$close()">OK</button></div>')}]);